<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Files And Directories | Learning Loop</title>
<meta name="keywords" content="Disk, OS, FileSystem">
<meta name="description" content="Files and directories
File systems virtualize persistent storage (e.g., hard drives, SSDs) into user-friendly files and directories, adding a third pillar to OS abstractions (processes for CPU, address spaces for memory).
File Paths and System Calls
Files are organized in a tree-like directory structure, starting from the root (/). A file’s location is identified by its pathname (e.g., /home/user/file.txt). To interact with files, processes use system calls:

open(path, flags): Opens a file and returns a file descriptor (fd).
read(fd, buffer, size): Reads data from the file into a buffer using the fd.
write(fd, buffer, size): Writes data to the file via the fd.
close(fd): Closes the file, freeing the fd.

File Descriptors
A file descriptor is a small integer, unique to each process, that identifies an open file. When a process calls open(), the operating system assigns it the next available fd (e.g., 3, 4, etc.). Every process starts with three default fds:">
<meta name="author" content="">
<link rel="canonical" href="https://harshrai654.github.io/blogs/files-and-directories/">
<link crossorigin="anonymous" href="/blogs/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css" integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF&#43;13Dyqob6ASlTrTye8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://harshrai654.github.io/blogs/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://harshrai654.github.io/blogs/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://harshrai654.github.io/blogs/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://harshrai654.github.io/blogs/apple-touch-icon.png">
<link rel="mask-icon" href="https://harshrai654.github.io/blogs/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://harshrai654.github.io/blogs/files-and-directories/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://harshrai654.github.io/blogs/files-and-directories/">
  <meta property="og:site_name" content="Learning Loop">
  <meta property="og:title" content="Files And Directories">
  <meta property="og:description" content="Files and directories File systems virtualize persistent storage (e.g., hard drives, SSDs) into user-friendly files and directories, adding a third pillar to OS abstractions (processes for CPU, address spaces for memory).
File Paths and System Calls Files are organized in a tree-like directory structure, starting from the root (/). A file’s location is identified by its pathname (e.g., /home/user/file.txt). To interact with files, processes use system calls:
open(path, flags): Opens a file and returns a file descriptor (fd). read(fd, buffer, size): Reads data from the file into a buffer using the fd. write(fd, buffer, size): Writes data to the file via the fd. close(fd): Closes the file, freeing the fd. File Descriptors A file descriptor is a small integer, unique to each process, that identifies an open file. When a process calls open(), the operating system assigns it the next available fd (e.g., 3, 4, etc.). Every process starts with three default fds:">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-02-23T20:41:00+00:00">
    <meta property="article:modified_time" content="2025-02-23T20:41:00+00:00">
    <meta property="article:tag" content="Disk">
    <meta property="article:tag" content="OS">
    <meta property="article:tag" content="FileSystem">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Files And Directories">
<meta name="twitter:description" content="Files and directories
File systems virtualize persistent storage (e.g., hard drives, SSDs) into user-friendly files and directories, adding a third pillar to OS abstractions (processes for CPU, address spaces for memory).
File Paths and System Calls
Files are organized in a tree-like directory structure, starting from the root (/). A file’s location is identified by its pathname (e.g., /home/user/file.txt). To interact with files, processes use system calls:

open(path, flags): Opens a file and returns a file descriptor (fd).
read(fd, buffer, size): Reads data from the file into a buffer using the fd.
write(fd, buffer, size): Writes data to the file via the fd.
close(fd): Closes the file, freeing the fd.

File Descriptors
A file descriptor is a small integer, unique to each process, that identifies an open file. When a process calls open(), the operating system assigns it the next available fd (e.g., 3, 4, etc.). Every process starts with three default fds:">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Files And Directories",
      "item": "https://harshrai654.github.io/blogs/files-and-directories/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Files And Directories",
  "name": "Files And Directories",
  "description": "Files and directories File systems virtualize persistent storage (e.g., hard drives, SSDs) into user-friendly files and directories, adding a third pillar to OS abstractions (processes for CPU, address spaces for memory).\nFile Paths and System Calls Files are organized in a tree-like directory structure, starting from the root (/). A file’s location is identified by its pathname (e.g., /home/user/file.txt). To interact with files, processes use system calls:\nopen(path, flags): Opens a file and returns a file descriptor (fd). read(fd, buffer, size): Reads data from the file into a buffer using the fd. write(fd, buffer, size): Writes data to the file via the fd. close(fd): Closes the file, freeing the fd. File Descriptors A file descriptor is a small integer, unique to each process, that identifies an open file. When a process calls open(), the operating system assigns it the next available fd (e.g., 3, 4, etc.). Every process starts with three default fds:\n",
  "keywords": [
    "Disk", "OS", "FileSystem"
  ],
  "articleBody": "Files and directories File systems virtualize persistent storage (e.g., hard drives, SSDs) into user-friendly files and directories, adding a third pillar to OS abstractions (processes for CPU, address spaces for memory).\nFile Paths and System Calls Files are organized in a tree-like directory structure, starting from the root (/). A file’s location is identified by its pathname (e.g., /home/user/file.txt). To interact with files, processes use system calls:\nopen(path, flags): Opens a file and returns a file descriptor (fd). read(fd, buffer, size): Reads data from the file into a buffer using the fd. write(fd, buffer, size): Writes data to the file via the fd. close(fd): Closes the file, freeing the fd. File Descriptors A file descriptor is a small integer, unique to each process, that identifies an open file. When a process calls open(), the operating system assigns it the next available fd (e.g., 3, 4, etc.). Every process starts with three default fds:\n0: Standard input (stdin) 1: Standard output (stdout) 2: Standard error (stderr) Quick Note: File Descriptors \u0026 Terminals Every process starts with three standard file descriptors:\n0 (stdin), 1 (stdout), 2 (stderr). Where They Point By default they link to a terminal device (e.g., /dev/pts/0 for Terminal 1, /dev/pts/1 for Terminal 2). These are character devices with a major number (e.g., 136) for the tty driver and a unique minor number (e.g., 0 or 1) for each instance.\nCommand Output (Terminal 1):\nls -l /proc/self/fd lrwx------ 1 runner runner 64 Feb 23 11:47 0 -\u003e /dev/pts/0 lrwx------ 1 runner runner 64 Feb 23 11:47 1 -\u003e /dev/pts/0 lrwx------ 1 runner runner 64 Feb 23 11:47 2 -\u003e /dev/pts/0 Device Details:\nls -l /dev/pts/0 crw--w---- 1 runner tty 136, 0 Feb 23 11:53 /dev/pts/0 ~/workspace$ stat /dev/pts/0 File: /dev/pts/0 Size: 0 Blocks: 0 IO Block: 1024 character special file Device: 0,1350 Inode: 3 Links: 1 Device type: 136,0 Access: (0620/crw--w----) Uid: ( 1000/ runner) Gid: ( 5/ tty) Access: 2025-02-23 12:13:52.419852946 +0000 Modify: 2025-02-23 12:13:52.419852946 +0000 Change: 2025-02-23 11:36:28.419852946 +0000 Birth: - Versus a File A regular file descriptor (e.g., for test.txt) points to a disk inode with data blocks, tied to a filesystem device (e.g., /dev/sda1), not a driver.\nExample:\nls -li test.txt 12345 -rw-r--r-- 1 runner runner 5 Feb 23 12:00 test.txt ~/workspace$ stat test.txt File: test.txt Size: 288 Blocks: 8 IO Block: 4096 regular file Device: 0,375 Inode: 1111 Links: 1 Access: (0644/-rw-r--r--) Uid: ( 1000/ runner) Gid: ( 1000/ runner) Access: 2025-02-23 11:40:57.014322027 +0000 Modify: 2025-02-23 11:41:41.800233516 +0000 Change: 2025-02-23 11:41:41.800233516 +0000 Birth: 2025-02-23 11:40:57.014322027 +0000 Fun Test Redirected Terminal 1’s output to Terminal 2:\nCommand: echo \"Hello\" \u003e /dev/pts/1 Result: “Hello” appeared in Terminal 2 (/dev/pts/1, minor 1)! Open File Table The Open File Table (OFT) is a system-wide structure in kernel memory that tracks all open files. Each entry in the OFT includes:\nThe current offset (position for the next read/write). Permissions (e.g., read, write). A reference count (if multiple processes share the file). Each process has its own array of file descriptors, where each fd maps to an entry in the OFT. For example, process A’s fd 3 and process B’s fd 4 might point to the same OFT entry if they’ve opened the same file.\nExample: Showing entries of a PID in open file table\n~/workspace$ lsof -p 113 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME bash 113 runner cwd DIR 0,375 394 256 /home/runner/workspace bash 113 runner rtd DIR 0,1324 4096 1562007 / bash 113 runner 0u CHR 136,0 0t0 3 /dev/pts/0 bash 113 runner 1u CHR 136,0 0t0 3 /dev/pts/0 bash 113 runner 2u CHR 136,0 0t0 3 /dev/pts/0 bash 113 runner 255u CHR 136,0 0t0 3 /dev/pts/0 As you see above that the process had 0,1 and 2 FDs as well as FD for a directory as well.\nReference counting in OFT Reference counting is a technique used in operating systems to manage entries in the Open File Table (OFT), which stores information about open files shared by processes or file descriptors.\nHow It Works Each OFT entry has a reference count that tracks how many file descriptors (from one or more processes) refer to it. When a file is opened, the reference count increases by 1. If the same file is reused (e.g., via fork() or dup()), the count increments without creating a new entry. When a file descriptor is closed (e.g., with close(fd)), the count decreases by 1. The OFT entry is removed only when the reference count reaches 0, meaning no process is using it. How It Helps Remove Entries Reference counting ensures an OFT entry is deleted only when it’s no longer needed. For example, after a fork(), both parent and child processes share the same OFT entry (reference count = 2). Closing the file in one process lowers the count to 1, but the entry persists until the second process closes it, bringing the count to 0.\nWhy It’s Useful This method efficiently manages shared file resources, preventing premature removal of file metadata (like the current offset) while any process still needs it.\nINode What is an Inode? An inode (short for “index node”) is a fundamental data structure in UNIX-based file systems. It stores essential metadata about a file, enabling the system to manage and locate files efficiently. Each file in the system is uniquely identified by its inode number (also called i-number). The metadata stored in an inode includes:\nFile size: The total size of the file in bytes.\nPermissions: Access rights defining who can read, write, or execute the file.\nOwnership: User ID (UID) and group ID (GID) of the file’s owner.\nTimestamps:\nLast access time (when the file was last read). Last modification time (when the file’s content was last changed). Last status change time (when the file’s metadata, like permissions, was last modified). Pointers to data blocks: Locations on disk where the file’s actual content is stored.\nThe inode does not store the file’s name or its content; these are managed separately. The inode’s role is to provide a compact and efficient way to access a file’s metadata. Each inode is stored in inode block in disk.\nHow the stat System Call Works The stat system call is used to retrieve metadata about a file without accessing its actual content. It provides a way for programs to query information like file size, permissions, and timestamps. Here’s how it works:\nInput: The stat system call takes a file path as input. Locate the inode: The file system uses the file path to find the corresponding inode number. (Insert link to FS implemetation note here explaining how FS searches inode and data block from given file path) Retrieve metadata: The inode is fetched from disk (or from a cache, if available, for faster access). Populate the struct stat buffer: The metadata stored in the inode is copied into a struct stat buffer, which contains fields for file size, permissions, ownership, timestamps, and more. Return to the user: The struct stat buffer is returned to the calling program, providing all the metadata for the file. Because the stat system call only accesses the inode and not the file’s content, it is a fast and efficient operation. This separation of metadata (stored in the inode) and content (stored in data blocks) allows the system to quickly retrieve file information without unnecessary disk I/O.\nDirectories ls -al Output for Directories\ntotal 152 drwxr-xr-x 1 runner runner 394 Feb 23 11:40 . drwxrwxrwx 1 runner runner 46 Feb 23 11:36 .. -rw-r--r-- 1 runner runner 174 Feb 15 11:31 .breakpoints drwxr-xr-x 1 runner runner 34 Feb 15 11:32 .cache drwxr-x--- 1 runner runner 260 Feb 15 11:31 .ccls-cache -rw-r--r-- 1 runner runner 1564 Dec 21 11:44 common_threads.h -rwxr-xr-x 1 runner runner 16128 Dec 21 11:54 deadlock -rw-r--r-- 1 runner runner 647 Dec 21 11:51 deadlock.c -rwxr-xr-x 1 runner runner 16160 Dec 21 11:57 deadlock-global -rw-r--r-- 1 runner runner 748 Dec 21 11:57 deadlock-global.c -rw-r--r-- 1 runner runner 6320 Feb 23 11:36 generated-icon.png -rw-r--r-- 1 runner runner 429 Mar 8 2024 .gitignore -rwxr-xr-x 1 runner runner 15984 Dec 21 11:51 main -rw-r--r-- 1 runner runner 415 Dec 21 11:51 main.c -rwxr-xr-x 1 runner runner 16816 Aug 16 2024 main-debug -rw-r--r-- 1 runner runner 411 Dec 12 2023 Makefile -rwxr-xr-x 1 runner runner 16136 Dec 14 11:04 mem -rw-r--r-- 1 runner runner 1437 Aug 16 2024 .replit -rw-r--r-- 1 runner runner 134 Feb 23 13:54 replit.nix -rwxr-xr-x 1 runner runner 15936 Dec 21 11:59 signal -rw-r--r-- 1 runner runner 329 Dec 21 11:59 signal.c -rw-r--r-- 1 runner runner 288 Feb 23 11:41 test.txt drwxr-xr-x 1 runner runner 42 Feb 15 11:32 wcat Size of a directory only means storage needed to store each directory entry which basically comprise entry name and its inode number along with some other metdata\nDirectory Data Block Contents The data blocks of a directory contain:\nDirectory entries: Mapping of file/subdirectory names to their inode numbers. Special entries: . (current directory) and .. (parent directory). Optimization for Small Directories For small directories, some file systems store directory entries directly in the inode itself, avoiding separate data blocks. This optimization saves space and speeds up access.\nReading Directory Entries with System Calls To programmatically read directory contents following sys calls are used:\nopendir(path): Opens the directory. readdir(dir): Reads one entry at a time (returns a struct dirent with name and inode number. closedir(dir): Closes the directory. Permission bits and their octal representation Format: ls -l displays permissions as rwxr-xr-x:\nFirst character: d (directory), - (file), or l (symlink). Next 9 bits: Three groups of rwx for owner, group, and others: r = read, w = write, x = execute (run for files, enter for directories). Converting a Full 9-Bit Permission to Numeric (Octal) Representation Example: rwxr-xr-x\nBreakdown: Split into three groups (owner, group, others): Owner: rwx. Group: r-x. Others: r-x. Step-by-Step Conversion\nOwner: rwx: r = 1, w = 1, x = 1 → Binary: 111. Decimal: 1×4 + 1×2 + 1×1 = 4 + 2 + 1 = 7. Group: r-x: r = 1, w = 0, x = 1 → Binary: 101. Decimal: 1×4 + 0×2 + 1×1 = 4 + 1 = 5. Others: r-x: r = 1, w = 0, x = 1 → Binary: 101. Decimal: 1×4 + 0×2 + 1×1 = 4 + 1 = 5. Final Octal Representation\nCombine the three digits: 7 5 5. Result: rwxr-xr-x = 755. Quick Recall: Split rwx into 3 groups, convert each to binary (1s/0s), sum (4, 2, 1), get octal (e.g., 755). Hard Links, Symbolic Links (Including Size), and File Deletion (Based on OSTEP PDF) Hard Links and unlink Definition: A hard link (PDF p. 18-19) is an extra directory entry pointing to the same inode, created with link(old, new).. When a directory reference its parent directory (with ..) it increases hard link count by 1. For a new empty directory its hard count is always 2 since it is referred by itself (with .) and also referred by its parent’s directory entry (with ..) With unlink: Removes a name-to-inode link, decrements the inode’s link count. When count hits 0 (and no processes use it), the inode and data blocks are freed from disk. Symbolic Links and Dangling References Definition: A symbolic (soft) link (PDF p. 20-21) is a distinct file storing a pathname to another file, created with ln -s old new. Size: Its size equals the length of the stored pathname (e.g., 4 bytes for “file”, 15 bytes for “alongerfilename”; PDF p. 21). How It Works: References the path, not the inode directly; accessing it resolves the path. Dangling Reference: If the target is deleted (e.g., unlink file), the symbolic link persists but points to nothing, causing errors (e.g., “No such file or directory”). Disk, Partition, Volume, File System Hierarchy, and Mounting Distinction and Hierarchy Disk: Physical storage device (e.g., hard drive, SSD) holding raw data blocks. Partition: A subdivided section of a disk (e.g., /dev/sda1), treated as a separate unit. Volume: A logical abstraction, often a partition or group of partitions, formatted with a file system (FS). File System: Software structure (e.g., ext3, AFS) organizing data into files and directories on a volume. Hierarchy: Disk → Partitions → Volumes → File Systems.\nMounting Process Creation: Use mkfs to format a partition with a file system (e.g., mkfs -t ext3 /dev/sda1 creates an empty FS). Mounting: The mount command (PDF p. 24) attaches a file system to the directory tree at a mount point (e.g., mount -t ext3 /dev/sda1 /home/users), making its contents accessible under that path. Multiple File Systems on One Machine A single machine can host multiple file systems by mounting them at different points in the tree (PDF p. 26). Example Output (from mount): /dev/sda1 on / type ext3 (rw) # Root FS /dev/sda5 on /tmp type ext3 (rw) # Separate tmp FS AFS on /afs type afs (rw) # Distributed FS How: Each partition or volume gets its own FS type and mount point, unified under one tree (e.g., /). Quick Recall: Disk splits into partitions; volumes get FS; mount glues them into a tree; multiple FS coexist at different paths.\nReferences https://pages.cs.wisc.edu/~remzi/OSTEP/file-intro.pdf https://grok.com/share/bGVnYWN5_47ab49d6-aa1d-4de1-9bbe-0d47332e12fe https://grok.com/share/bGVnYWN5_7db77c97-d33d-4543-9993-d5aa362c8b2b ",
  "wordCount" : "2195",
  "inLanguage": "en",
  "datePublished": "2025-02-23T20:41:00Z",
  "dateModified": "2025-02-23T20:41:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://harshrai654.github.io/blogs/files-and-directories/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Learning Loop",
    "logo": {
      "@type": "ImageObject",
      "url": "https://harshrai654.github.io/blogs/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://harshrai654.github.io/blogs/" accesskey="h" title="Learning Loop (Alt + H)">Learning Loop</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://harshrai654.github.io/blogs/">Home</a></div>
    <h1 class="post-title entry-hint-parent">
      Files And Directories
    </h1>
    <div class="post-meta"><span title='2025-02-23 20:41:00 +0000 UTC'>February 23, 2025</span>&nbsp;·&nbsp;11 min

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#files-and-directories" aria-label="Files and directories">Files and directories</a><ul>
                        
                <li>
                    <a href="#file-paths-and-system-calls" aria-label="File Paths and System Calls">File Paths and System Calls</a></li>
                <li>
                    <a href="#file-descriptors" aria-label="File Descriptors">File Descriptors</a></li>
                <li>
                    <a href="#quick-note-file-descriptors--terminals" aria-label="Quick Note: File Descriptors &amp; Terminals">Quick Note: File Descriptors &amp; Terminals</a><ul>
                        
                <li>
                    <a href="#where-they-point" aria-label="Where They Point">Where They Point</a></li>
                <li>
                    <a href="#versus-a-file" aria-label="Versus a File">Versus a File</a></li>
                <li>
                    <a href="#fun-test" aria-label="Fun Test">Fun Test</a></li></ul>
                </li>
                <li>
                    <a href="#open-file-table" aria-label="Open File Table">Open File Table</a><ul>
                        
                <li>
                    <a href="#reference-counting-in-oft" aria-label="Reference counting in OFT">Reference counting in OFT</a><ul>
                        
                <li>
                    <a href="#how-it-works" aria-label="How It Works">How It Works</a></li>
                <li>
                    <a href="#how-it-helps-remove-entries" aria-label="How It Helps Remove Entries">How It Helps Remove Entries</a></li>
                <li>
                    <a href="#why-its-useful" aria-label="Why It’s Useful">Why It’s Useful</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#inode" aria-label="INode">INode</a><ul>
                        <ul>
                        
                <li>
                    <a href="#what-is-an-inode" aria-label="What is an Inode?">What is an Inode?</a></li>
                <li>
                    <a href="#how-the-stat-system-call-works" aria-label="How the stat System Call Works">How the stat System Call Works</a></li></ul>
                    </ul>
                </li></ul>
                </li>
                <li>
                    <a href="#directories" aria-label="Directories">Directories</a><ul>
                        <ul>
                        <ul>
                        
                <li>
                    <a href="#directory-data-block-contents" aria-label="Directory Data Block Contents">Directory Data Block Contents</a></li>
                <li>
                    <a href="#optimization-for-small-directories" aria-label="Optimization for Small Directories">Optimization for Small Directories</a></li>
                <li>
                    <a href="#reading-directory-entries-with-system-calls" aria-label="Reading Directory Entries with System Calls">Reading Directory Entries with System Calls</a></li>
                <li>
                    <a href="#permission-bits-and-their-octal-representation" aria-label="Permission bits and their octal representation">Permission bits and their octal representation</a><ul>
                        
                <li>
                    <a href="#converting-a-full-9-bit-permission-to-numeric-octal-representation" aria-label="Converting a Full 9-Bit Permission to Numeric (Octal) Representation">Converting a Full 9-Bit Permission to Numeric (Octal) Representation</a></li></ul>
                </li></ul>
                    
                <li>
                    <a href="#hard-links-symbolic-links-including-size-and-file-deletion-based-on-ostep-pdf" aria-label="Hard Links, Symbolic Links (Including Size), and File Deletion (Based on OSTEP PDF)">Hard Links, Symbolic Links (Including Size), and File Deletion (Based on OSTEP PDF)</a><ul>
                        
                <li>
                    <a href="#hard-links-and-unlink" aria-label="Hard Links and unlink">Hard Links and unlink</a></li>
                <li>
                    <a href="#symbolic-links-and-dangling-references" aria-label="Symbolic Links and Dangling References">Symbolic Links and Dangling References</a></li></ul>
                </li></ul>
                    
                <li>
                    <a href="#disk-partition-volume-file-system-hierarchy-and-mounting" aria-label="Disk, Partition, Volume, File System Hierarchy, and Mounting">Disk, Partition, Volume, File System Hierarchy, and Mounting</a><ul>
                        <ul>
                        
                <li>
                    <a href="#distinction-and-hierarchy" aria-label="Distinction and Hierarchy">Distinction and Hierarchy</a></li>
                <li>
                    <a href="#mounting-process" aria-label="Mounting Process">Mounting Process</a></li>
                <li>
                    <a href="#multiple-file-systems-on-one-machine" aria-label="Multiple File Systems on One Machine">Multiple File Systems on One Machine</a></li></ul>
                    </ul>
                </li></ul>
                </li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="files-and-directories">Files and directories<a hidden class="anchor" aria-hidden="true" href="#files-and-directories">#</a></h1>
<p>File systems virtualize persistent storage (e.g., hard drives, SSDs) into user-friendly files and directories, adding a third pillar to OS abstractions (processes for CPU, address spaces for memory).</p>
<h2 id="file-paths-and-system-calls">File Paths and System Calls<a hidden class="anchor" aria-hidden="true" href="#file-paths-and-system-calls">#</a></h2>
<p>Files are organized in a <strong>tree-like directory structure</strong>, starting from the root (/). A file’s location is identified by its <strong>pathname</strong> (e.g., /home/user/file.txt). To interact with files, processes use <strong>system calls</strong>:</p>
<ul>
<li><strong>open(path, flags)</strong>: Opens a file and returns a <strong>file descriptor</strong> (fd).</li>
<li><strong>read(fd, buffer, size)</strong>: Reads data from the file into a buffer using the fd.</li>
<li><strong>write(fd, buffer, size)</strong>: Writes data to the file via the fd.</li>
<li><strong>close(fd)</strong>: Closes the file, freeing the fd.</li>
</ul>
<h2 id="file-descriptors">File Descriptors<a hidden class="anchor" aria-hidden="true" href="#file-descriptors">#</a></h2>
<p>A <strong>file descriptor</strong> is a small integer, unique to each process, that identifies an open file. When a process calls open(), the operating system assigns it the next available fd (e.g., 3, 4, etc.). Every process starts with three default fds:</p>
<ul>
<li><strong>0</strong>: Standard input (<em>stdin</em>)</li>
<li><strong>1</strong>: Standard output (<em>stdout</em>)</li>
<li><strong>2</strong>: Standard error (<em>stderr</em>)</li>
</ul>
<h2 id="quick-note-file-descriptors--terminals">Quick Note: File Descriptors &amp; Terminals<a hidden class="anchor" aria-hidden="true" href="#quick-note-file-descriptors--terminals">#</a></h2>
<p>Every process starts with three standard file descriptors:</p>
<ul>
<li><code>0</code> (stdin), <code>1</code> (stdout), <code>2</code> (stderr).</li>
</ul>
<h3 id="where-they-point">Where They Point<a hidden class="anchor" aria-hidden="true" href="#where-they-point">#</a></h3>
<p>By default they link to a terminal device (e.g., <code>/dev/pts/0</code> for Terminal 1, <code>/dev/pts/1</code> for Terminal 2). These are character devices with a major number (e.g., 136) for the tty driver and a unique minor number (e.g., 0 or 1) for each instance.</p>
<p><strong>Command Output (Terminal 1)</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ls -l /proc/self/fd
</span></span><span style="display:flex;"><span>lrwx------ <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">64</span> Feb <span style="color:#ae81ff">23</span> 11:47 <span style="color:#ae81ff">0</span> -&gt; /dev/pts/0
</span></span><span style="display:flex;"><span>lrwx------ <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">64</span> Feb <span style="color:#ae81ff">23</span> 11:47 <span style="color:#ae81ff">1</span> -&gt; /dev/pts/0
</span></span><span style="display:flex;"><span>lrwx------ <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">64</span> Feb <span style="color:#ae81ff">23</span> 11:47 <span style="color:#ae81ff">2</span> -&gt; /dev/pts/0
</span></span></code></pre></div><p><strong>Device Details</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ls -l /dev/pts/0
</span></span><span style="display:flex;"><span>crw--w---- <span style="color:#ae81ff">1</span> runner tty 136, <span style="color:#ae81ff">0</span> Feb <span style="color:#ae81ff">23</span> 11:53 /dev/pts/0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>~/workspace$ stat /dev/pts/0
</span></span><span style="display:flex;"><span>File: /dev/pts/0
</span></span><span style="display:flex;"><span>Size: <span style="color:#ae81ff">0</span>           Blocks: <span style="color:#ae81ff">0</span>          IO Block: <span style="color:#ae81ff">1024</span>   character special file
</span></span><span style="display:flex;"><span>Device: 0,1350  Inode: <span style="color:#ae81ff">3</span>           Links: <span style="color:#ae81ff">1</span>     Device type: 136,0
</span></span><span style="display:flex;"><span>Access: <span style="color:#f92672">(</span>0620/crw--w----<span style="color:#f92672">)</span>  Uid: <span style="color:#f92672">(</span> 1000/  runner<span style="color:#f92672">)</span>   Gid: <span style="color:#f92672">(</span>    5/     tty<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Access: 2025-02-23 12:13:52.419852946 +0000
</span></span><span style="display:flex;"><span>Modify: 2025-02-23 12:13:52.419852946 +0000
</span></span><span style="display:flex;"><span>Change: 2025-02-23 11:36:28.419852946 +0000
</span></span><span style="display:flex;"><span> Birth: -
</span></span></code></pre></div><h3 id="versus-a-file">Versus a File<a hidden class="anchor" aria-hidden="true" href="#versus-a-file">#</a></h3>
<p>A regular file descriptor (e.g., for <em>test.txt)</em> points to a disk inode with data blocks, tied to a filesystem device (e.g., <em>/dev/sda1</em>), not a driver.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ls -li test.txt
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12345</span> -rw-r--r-- <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">5</span> Feb <span style="color:#ae81ff">23</span> 12:00 test.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>~/workspace$ stat test.txt
</span></span><span style="display:flex;"><span>  File: test.txt
</span></span><span style="display:flex;"><span>  Size: <span style="color:#ae81ff">288</span>         Blocks: <span style="color:#ae81ff">8</span>          IO Block: <span style="color:#ae81ff">4096</span>   regular file
</span></span><span style="display:flex;"><span>Device: 0,375   Inode: <span style="color:#ae81ff">1111</span>        Links: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Access: <span style="color:#f92672">(</span>0644/-rw-r--r--<span style="color:#f92672">)</span>  Uid: <span style="color:#f92672">(</span> 1000/  runner<span style="color:#f92672">)</span>   Gid: <span style="color:#f92672">(</span> 1000/  runner<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Access: 2025-02-23 11:40:57.014322027 +0000
</span></span><span style="display:flex;"><span>Modify: 2025-02-23 11:41:41.800233516 +0000
</span></span><span style="display:flex;"><span>Change: 2025-02-23 11:41:41.800233516 +0000
</span></span><span style="display:flex;"><span> Birth: 2025-02-23 11:40:57.014322027 +0000
</span></span></code></pre></div><h3 id="fun-test">Fun Test<a hidden class="anchor" aria-hidden="true" href="#fun-test">#</a></h3>
<p>Redirected Terminal 1’s output to Terminal 2:</p>
<ul>
<li><strong>Command</strong>:  <code>echo &quot;Hello&quot; &gt; /dev/pts/1</code></li>
<li><strong>Result</strong>: &ldquo;Hello&rdquo; appeared in Terminal 2 (/dev/pts/1, minor 1)!</li>
</ul>
<h2 id="open-file-table">Open File Table<a hidden class="anchor" aria-hidden="true" href="#open-file-table">#</a></h2>
<p>The <strong>Open File Table (OFT)</strong> is a system-wide structure in kernel memory that tracks all open files. Each entry in the OFT includes:</p>
<ul>
<li>The <strong>current offset</strong> (position for the next read/write).</li>
<li>Permissions (e.g., read, write).</li>
<li>A <strong>reference count</strong> (if multiple processes share the file).</li>
</ul>
<p>Each process has its own array of file descriptors, where each fd maps to an entry in the OFT. For example, process A’s fd 3 and process B’s fd 4 might point to the same OFT entry if they’ve opened the same file.</p>
<p>Example: Showing entries of a PID in open file table</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>~/workspace$ lsof -p <span style="color:#ae81ff">113</span>
</span></span><span style="display:flex;"><span>COMMAND PID   USER  FD   TYPE DEVICE SIZE/OFF    NODE NAME
</span></span><span style="display:flex;"><span>bash    <span style="color:#ae81ff">113</span> runner cwd    DIR  0,375      <span style="color:#ae81ff">394</span>     <span style="color:#ae81ff">256</span> /home/runner/workspace
</span></span><span style="display:flex;"><span>bash    <span style="color:#ae81ff">113</span> runner rtd    DIR 0,1324     <span style="color:#ae81ff">4096</span> <span style="color:#ae81ff">1562007</span> /
</span></span><span style="display:flex;"><span>bash    <span style="color:#ae81ff">113</span> runner   0u   CHR  136,0      0t0       <span style="color:#ae81ff">3</span> /dev/pts/0
</span></span><span style="display:flex;"><span>bash    <span style="color:#ae81ff">113</span> runner   1u   CHR  136,0      0t0       <span style="color:#ae81ff">3</span> /dev/pts/0
</span></span><span style="display:flex;"><span>bash    <span style="color:#ae81ff">113</span> runner   2u   CHR  136,0      0t0       <span style="color:#ae81ff">3</span> /dev/pts/0
</span></span><span style="display:flex;"><span>bash    <span style="color:#ae81ff">113</span> runner 255u   CHR  136,0      0t0       <span style="color:#ae81ff">3</span> /dev/pts/0
</span></span></code></pre></div><p>As you see above that the process had 0,1 and 2 FDs as well as FD for a directory as well.</p>
<h3 id="reference-counting-in-oft">Reference counting in OFT<a hidden class="anchor" aria-hidden="true" href="#reference-counting-in-oft">#</a></h3>
<p><strong>Reference counting</strong> is a technique used in operating systems to manage entries in the <strong>Open File Table (OFT)</strong>, which stores information about open files shared by processes or file descriptors.</p>
<h4 id="how-it-works">How It Works<a hidden class="anchor" aria-hidden="true" href="#how-it-works">#</a></h4>
<ul>
<li>Each OFT entry has a <strong>reference count</strong> that tracks how many file descriptors (from one or more processes) refer to it.</li>
<li>When a file is opened, the reference count increases by 1.</li>
<li>If the same file is reused (e.g., via fork() or dup()), the count increments without creating a new entry.</li>
<li>When a file descriptor is closed (e.g., with close(fd)), the count decreases by 1.</li>
<li>The OFT entry is <strong>removed</strong> only when the reference count reaches <strong>0</strong>, meaning no process is using it.</li>
</ul>
<h4 id="how-it-helps-remove-entries">How It Helps Remove Entries<a hidden class="anchor" aria-hidden="true" href="#how-it-helps-remove-entries">#</a></h4>
<p>Reference counting ensures an OFT entry is deleted only when it’s no longer needed. For example, after a fork(), both parent and child processes share the same OFT entry (reference count = 2). Closing the file in one process lowers the count to 1, but the entry persists until the second process closes it, bringing the count to 0.</p>
<h4 id="why-its-useful">Why It’s Useful<a hidden class="anchor" aria-hidden="true" href="#why-its-useful">#</a></h4>
<p>This method efficiently manages shared file resources, preventing premature removal of file metadata (like the current offset) while any process still needs it.</p>
<h2 id="inode">INode<a hidden class="anchor" aria-hidden="true" href="#inode">#</a></h2>
<h4 id="what-is-an-inode">What is an Inode?<a hidden class="anchor" aria-hidden="true" href="#what-is-an-inode">#</a></h4>
<p>An inode (short for &ldquo;index node&rdquo;) is a fundamental data structure in UNIX-based file systems. It stores essential metadata about a file, enabling the system to manage and locate files efficiently. Each file in the system is uniquely identified by its inode number (also called i-number). The metadata stored in an inode includes:</p>
<ul>
<li>
<p><strong>File size</strong>: The total size of the file in bytes.</p>
</li>
<li>
<p><strong>Permissions</strong>: Access rights defining who can read, write, or execute the file.</p>
</li>
<li>
<p><strong>Ownership</strong>: User ID (UID) and group ID (GID) of the file&rsquo;s owner.</p>
</li>
<li>
<p><strong>Timestamps</strong>:</p>
<ul>
<li>Last access time (when the file was last read).</li>
<li>Last modification time (when the file&rsquo;s content was last changed).</li>
<li>Last status change time (when the file&rsquo;s metadata, like permissions, was last modified).</li>
</ul>
</li>
<li>
<p><strong>Pointers to data blocks</strong>: Locations on disk where the file&rsquo;s actual content is stored.</p>
</li>
</ul>
<p>The inode does not store the file&rsquo;s name or its content; these are managed separately. The inode&rsquo;s role is to provide a compact and efficient way to access a file&rsquo;s metadata. Each inode is stored in inode block in disk.</p>
<h4 id="how-the-stat-system-call-works">How the stat System Call Works<a hidden class="anchor" aria-hidden="true" href="#how-the-stat-system-call-works">#</a></h4>
<p>The stat system call is used to retrieve metadata about a file without accessing its actual content. It provides a way for programs to query information like file size, permissions, and timestamps. Here&rsquo;s how it works:</p>
<ol>
<li><strong>Input</strong>: The stat system call takes a file path as input.</li>
<li><strong>Locate the inode</strong>: The file system uses the file path to find the corresponding inode number. (Insert link to FS implemetation note here explaining how FS searches inode and data block from given file path)</li>
<li><strong>Retrieve metadata</strong>: The inode is fetched from disk (or from a cache, if available, for faster access).</li>
<li><strong>Populate the struct stat buffer</strong>: The metadata stored in the inode is copied into a struct stat buffer, which contains fields for file size, permissions, ownership, timestamps, and more.</li>
<li><strong>Return to the user</strong>: The struct stat buffer is returned to the calling program, providing all the metadata for the file.</li>
</ol>
<p>Because the stat system call only accesses the inode and not the file&rsquo;s content, it is a fast and efficient operation. This separation of metadata (stored in the inode) and content (stored in data blocks) allows the system to quickly retrieve file information without unnecessary disk I/O.</p>
<h1 id="directories">Directories<a hidden class="anchor" aria-hidden="true" href="#directories">#</a></h1>
<p><code>ls -al</code> Output for Directories</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>total <span style="color:#ae81ff">152</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">394</span> Feb <span style="color:#ae81ff">23</span> 11:40 .
</span></span><span style="display:flex;"><span>drwxrwxrwx <span style="color:#ae81ff">1</span> runner runner    <span style="color:#ae81ff">46</span> Feb <span style="color:#ae81ff">23</span> 11:36 ..
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">174</span> Feb <span style="color:#ae81ff">15</span> 11:31 .breakpoints
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">1</span> runner runner    <span style="color:#ae81ff">34</span> Feb <span style="color:#ae81ff">15</span> 11:32 .cache
</span></span><span style="display:flex;"><span>drwxr-x--- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">260</span> Feb <span style="color:#ae81ff">15</span> 11:31 .ccls-cache
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner  <span style="color:#ae81ff">1564</span> Dec <span style="color:#ae81ff">21</span> 11:44 common_threads.h
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">16128</span> Dec <span style="color:#ae81ff">21</span> 11:54 deadlock
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">647</span> Dec <span style="color:#ae81ff">21</span> 11:51 deadlock.c
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">16160</span> Dec <span style="color:#ae81ff">21</span> 11:57 deadlock-global
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">748</span> Dec <span style="color:#ae81ff">21</span> 11:57 deadlock-global.c
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner  <span style="color:#ae81ff">6320</span> Feb <span style="color:#ae81ff">23</span> 11:36 generated-icon.png
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">429</span> Mar  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2024</span> .gitignore
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">15984</span> Dec <span style="color:#ae81ff">21</span> 11:51 main
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">415</span> Dec <span style="color:#ae81ff">21</span> 11:51 main.c
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">16816</span> Aug <span style="color:#ae81ff">16</span>  <span style="color:#ae81ff">2024</span> main-debug
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">411</span> Dec <span style="color:#ae81ff">12</span>  <span style="color:#ae81ff">2023</span> Makefile
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">16136</span> Dec <span style="color:#ae81ff">14</span> 11:04 mem
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner  <span style="color:#ae81ff">1437</span> Aug <span style="color:#ae81ff">16</span>  <span style="color:#ae81ff">2024</span> .replit
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">134</span> Feb <span style="color:#ae81ff">23</span> 13:54 replit.nix
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> runner runner <span style="color:#ae81ff">15936</span> Dec <span style="color:#ae81ff">21</span> 11:59 signal
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">329</span> Dec <span style="color:#ae81ff">21</span> 11:59 signal.c
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> runner runner   <span style="color:#ae81ff">288</span> Feb <span style="color:#ae81ff">23</span> 11:41 test.txt
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">1</span> runner runner    <span style="color:#ae81ff">42</span> Feb <span style="color:#ae81ff">15</span> 11:32 wcat
</span></span></code></pre></div><p>Size of a directory only means storage needed to store each directory entry which basically comprise entry name and its inode number along with some other metdata</p>
<h4 id="directory-data-block-contents">Directory Data Block Contents<a hidden class="anchor" aria-hidden="true" href="#directory-data-block-contents">#</a></h4>
<p>The data blocks of a directory contain:</p>
<ul>
<li><strong>Directory entries</strong>: Mapping of file/subdirectory names to their inode numbers.</li>
<li><strong>Special entries</strong>: . (current directory) and .. (parent directory).</li>
</ul>
<h4 id="optimization-for-small-directories">Optimization for Small Directories<a hidden class="anchor" aria-hidden="true" href="#optimization-for-small-directories">#</a></h4>
<p>For small directories, some file systems store directory entries directly in the inode itself, avoiding separate data blocks. This optimization saves space and speeds up access.</p>
<h4 id="reading-directory-entries-with-system-calls">Reading Directory Entries with System Calls<a hidden class="anchor" aria-hidden="true" href="#reading-directory-entries-with-system-calls">#</a></h4>
<p>To programmatically read directory contents following sys calls are used:</p>
<ul>
<li><strong>opendir(path)</strong>: Opens the directory.</li>
<li><strong>readdir(dir)</strong>: Reads one entry at a time (returns a struct <code>dirent</code> with name and inode number.</li>
<li><strong>closedir(dir)</strong>: Closes the directory.</li>
</ul>
<h4 id="permission-bits-and-their-octal-representation">Permission bits and their octal representation<a hidden class="anchor" aria-hidden="true" href="#permission-bits-and-their-octal-representation">#</a></h4>
<p><strong>Format</strong>: ls -l displays permissions as rwxr-xr-x:</p>
<ul>
<li>First character: d (directory), - (file), or l (symlink).</li>
<li>Next 9 bits: Three groups of rwx for <strong>owner</strong>, <strong>group</strong>, and <strong>others</strong>:
<ul>
<li>r = read, w = write, x = execute (run for files, enter for directories).</li>
</ul>
</li>
</ul>
<h5 id="converting-a-full-9-bit-permission-to-numeric-octal-representation">Converting a Full 9-Bit Permission to Numeric (Octal) Representation<a hidden class="anchor" aria-hidden="true" href="#converting-a-full-9-bit-permission-to-numeric-octal-representation">#</a></h5>
<p><strong>Example</strong>: <code>rwxr-xr-x</code></p>
<ul>
<li><strong>Breakdown</strong>: Split into three groups (owner, group, others):
<ul>
<li><strong>Owner</strong>: <code>rwx</code>.</li>
<li><strong>Group</strong>:<code> r-x</code>.</li>
<li><strong>Others</strong>:<code> r-x</code>.</li>
</ul>
</li>
</ul>
<p><strong>Step-by-Step Conversion</strong></p>
<ol>
<li><strong>Owner: rwx</strong>:
<ul>
<li>r = 1, w = 1, x = 1 → Binary: 111.</li>
<li>Decimal: 1×4 + 1×2 + 1×1 = 4 + 2 + 1 = 7.</li>
</ul>
</li>
<li><strong>Group: r-x</strong>:
<ul>
<li>r = 1, w = 0, x = 1 → Binary: 101.</li>
<li>Decimal: 1×4 + 0×2 + 1×1 = 4 + 1 = 5.</li>
</ul>
</li>
<li><strong>Others: r-x</strong>:
<ul>
<li>r = 1, w = 0, x = 1 → Binary: 101.</li>
<li>Decimal: 1×4 + 0×2 + 1×1 = 4 + 1 = 5.</li>
<li></li>
</ul>
</li>
</ol>
<p><strong>Final Octal Representation</strong></p>
<ul>
<li>Combine the three digits: 7 5 5.</li>
<li><strong>Result</strong>: rwxr-xr-x = 755.
<em>Quick Recall</em>: Split rwx into 3 groups, convert each to binary (1s/0s), sum (4, 2, 1), get octal (e.g., 755).</li>
</ul>
<h3 id="hard-links-symbolic-links-including-size-and-file-deletion-based-on-ostep-pdf">Hard Links, Symbolic Links (Including Size), and File Deletion (Based on OSTEP PDF)<a hidden class="anchor" aria-hidden="true" href="#hard-links-symbolic-links-including-size-and-file-deletion-based-on-ostep-pdf">#</a></h3>
<h4 id="hard-links-and-unlink">Hard Links and unlink<a hidden class="anchor" aria-hidden="true" href="#hard-links-and-unlink">#</a></h4>
<ul>
<li><strong>Definition</strong>: A hard link (PDF p. 18-19) is an extra directory entry pointing to the same inode, created with <code>link(old, new).</code>. When a directory reference its parent directory (with <code>..</code>)  it increases hard link count by 1.
For a new empty directory its hard count is always 2 since it is referred by itself (with <code>.</code>) and also referred by its parent&rsquo;s directory entry (with <code>..</code>)</li>
<li><strong>With unlink</strong>: Removes a name-to-inode link, decrements the inode’s <strong>link count</strong>. When count hits 0 (and no processes use it), the inode and data blocks are freed from disk.</li>
</ul>
<h4 id="symbolic-links-and-dangling-references">Symbolic Links and Dangling References<a hidden class="anchor" aria-hidden="true" href="#symbolic-links-and-dangling-references">#</a></h4>
<ul>
<li><strong>Definition</strong>: A symbolic (soft) link (PDF p. 20-21) is a distinct file storing a pathname to another file, created with<code> ln -s old new</code>.</li>
<li><strong>Size</strong>: Its size equals the length of the stored pathname (e.g., 4 bytes for &ldquo;file&rdquo;, 15 bytes for &ldquo;alongerfilename&rdquo;; PDF p. 21).</li>
<li><strong>How It Works</strong>: References the path, not the inode directly; accessing it resolves the path.</li>
<li><strong>Dangling Reference</strong>: If the target is deleted (e.g., unlink file), the symbolic link persists but points to nothing, causing errors (e.g., &ldquo;No such file or directory&rdquo;).</li>
</ul>
<h2 id="disk-partition-volume-file-system-hierarchy-and-mounting">Disk, Partition, Volume, File System Hierarchy, and Mounting<a hidden class="anchor" aria-hidden="true" href="#disk-partition-volume-file-system-hierarchy-and-mounting">#</a></h2>
<h4 id="distinction-and-hierarchy">Distinction and Hierarchy<a hidden class="anchor" aria-hidden="true" href="#distinction-and-hierarchy">#</a></h4>
<ul>
<li><strong>Disk</strong>: Physical storage device (e.g., hard drive, SSD) holding raw data blocks.</li>
<li><strong>Partition</strong>: A subdivided section of a disk (e.g., <code>/dev/sda1</code>), treated as a separate unit.</li>
<li><strong>Volume</strong>: A logical abstraction, often a partition or group of partitions, formatted with a file system (FS).</li>
<li><strong>File System</strong>: Software structure (e.g.,<code> ext3, AFS</code>) organizing data into files and directories on a volume.</li>
</ul>
<p><em>Hierarchy</em>: Disk → Partitions → Volumes → File Systems.</p>
<h4 id="mounting-process">Mounting Process<a hidden class="anchor" aria-hidden="true" href="#mounting-process">#</a></h4>
<ul>
<li><strong>Creation</strong>: Use <code>mkfs</code> to format a partition with a file system (e.g., <code>mkfs -t ext3 /dev/sda1 </code>creates an empty FS).</li>
<li><strong>Mounting</strong>: The mount command (PDF p. 24) attaches a file system to the directory tree at a <strong>mount point</strong> (e.g., <code>mount -t ext3 /dev/sda1 /home/users</code>), making its contents accessible under that path.</li>
</ul>
<h4 id="multiple-file-systems-on-one-machine">Multiple File Systems on One Machine<a hidden class="anchor" aria-hidden="true" href="#multiple-file-systems-on-one-machine">#</a></h4>
<ul>
<li>A single machine can host multiple file systems by mounting them at different points in the tree (PDF p. 26).</li>
<li><strong>Example Output</strong> (from <code>mount</code>):</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/dev/sda1 on / type ext3 <span style="color:#f92672">(</span>rw<span style="color:#f92672">)</span> <span style="color:#75715e"># Root FS</span>
</span></span><span style="display:flex;"><span>/dev/sda5 on /tmp type ext3 <span style="color:#f92672">(</span>rw<span style="color:#f92672">)</span> <span style="color:#75715e"># Separate tmp FS  </span>
</span></span><span style="display:flex;"><span>AFS on /afs type afs <span style="color:#f92672">(</span>rw<span style="color:#f92672">)</span> <span style="color:#75715e"># Distributed FS</span>
</span></span></code></pre></div><ul>
<li><strong>How</strong>: Each partition or volume gets its own FS type and mount point, unified under one tree (e.g., /).</li>
</ul>
<p><em>Quick Recall</em>: Disk splits into partitions; volumes get FS; mount glues them into a tree; multiple FS coexist at different paths.</p>
<h1 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h1>
<ul>
<li><a href="https://pages.cs.wisc.edu/~remzi/OSTEP/file-intro.pdf">https://pages.cs.wisc.edu/~remzi/OSTEP/file-intro.pdf</a></li>
<li><a href="https://grok.com/share/bGVnYWN5_47ab49d6-aa1d-4de1-9bbe-0d47332e12fe">https://grok.com/share/bGVnYWN5_47ab49d6-aa1d-4de1-9bbe-0d47332e12fe</a></li>
<li><a href="https://grok.com/share/bGVnYWN5_7db77c97-d33d-4543-9993-d5aa362c8b2b">https://grok.com/share/bGVnYWN5_7db77c97-d33d-4543-9993-d5aa362c8b2b</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://harshrai654.github.io/blogs/tags/disk/">Disk</a></li>
      <li><a href="https://harshrai654.github.io/blogs/tags/os/">OS</a></li>
      <li><a href="https://harshrai654.github.io/blogs/tags/filesystem/">FileSystem</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://harshrai654.github.io/blogs/file-system-implementation/">
    <span class="title">« Prev</span>
    <br>
    <span>Understanding Inodes and Disk Layout</span>
  </a>
  <a class="next" href="https://harshrai654.github.io/blogs/raid-redundant-array-of-inexpensive-disk/">
    <span class="title">Next »</span>
    <br>
    <span>RAID (Redundant array of inexpensive disk)</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Files And Directories on x"
            href="https://x.com/intent/tweet/?text=Files%20And%20Directories&amp;url=https%3a%2f%2fharshrai654.github.io%2fblogs%2ffiles-and-directories%2f&amp;hashtags=Disk%2cOS%2cFileSystem">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Files And Directories on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fharshrai654.github.io%2fblogs%2ffiles-and-directories%2f&amp;title=Files%20And%20Directories&amp;summary=Files%20And%20Directories&amp;source=https%3a%2f%2fharshrai654.github.io%2fblogs%2ffiles-and-directories%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Files And Directories on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fharshrai654.github.io%2fblogs%2ffiles-and-directories%2f&title=Files%20And%20Directories">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Files And Directories on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fharshrai654.github.io%2fblogs%2ffiles-and-directories%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Files And Directories on whatsapp"
            href="https://api.whatsapp.com/send?text=Files%20And%20Directories%20-%20https%3a%2f%2fharshrai654.github.io%2fblogs%2ffiles-and-directories%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Files And Directories on telegram"
            href="https://telegram.me/share/url?text=Files%20And%20Directories&amp;url=https%3a%2f%2fharshrai654.github.io%2fblogs%2ffiles-and-directories%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Files And Directories on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Files%20And%20Directories&u=https%3a%2f%2fharshrai654.github.io%2fblogs%2ffiles-and-directories%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://harshrai654.github.io/blogs/">Learning Loop</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
